name: d2l
channels:
  - conda-forge
  - defaults
dependencies:
  # Use Python 3.9 for best compatibility with the book's dependencies
  - python=3.9
  # Install scientific packages via conda (has pre-built binaries)
  - numpy=1.23.5
  - matplotlib=3.7.2
  - pandas=2.0.3
  - scipy=1.10.1
  # Jupyter kernel support
  - ipykernel
  - pip
  - pip:
    # Core dependencies from setup.py
    - jupyter==1.0.0
    - matplotlib-inline==0.1.6
    - requests==2.31.0
    # For viewing markdown files in Jupyter
    - mu-notedown
    # For building the book
    - d2lbook
    # Code formatting (required by d2lbook)
    - autopep8
    # Fix compatibility: nbconvert 7.x requires mistune 3.x
    - mistune>=3.0.0

# Installation Notes:
# To avoid memory issues (std::bad_alloc) when installing all packages at once,
# use a staged installation approach:
#
# Step 1: Install basic libraries first:
#   mamba env create -f environment-base.yml -vvv
#
# Step 2: Activate the environment and install PyTorch separately:
#   conda activate d2l
#   pip install torch==2.0.0 torchvision==0.15.1
#
# Step 3: Fix dependency compatibility issues (if encountered):
#   pip install "pybtex==0.24.0"  # Required for sphinxcontrib-bibtex 2.4.2
#   conda install -c conda-forge pandoc  # Required for RST conversion
#
# Alternative: If mamba still fails, use conda instead:
#   conda env create -f environment-base.yml

